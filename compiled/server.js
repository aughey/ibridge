var common=require("./common"),net=require("net"),argv=require("optimist").argv,io=common.newServer(argv.p||3001);io.sockets.on("connection",function(e){var t=null;e.on("data",function(n){n["c"]=="x"?t&&t.destroy():n["c"]=="c"?t=net.connect(22,"localhost",function(){t.on("data",function(t){e.emit("data",{c:"d",d:t.toString("binary")})}),t.on("close",function(){e.emit("data",{c:"x"}),t=null})}):n["c"]=="d"&&(!t||t.write(new Buffer(n.d,"binary")))}),e.on("disconnect",function(){t&&t.dst})});