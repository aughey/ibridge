var common=require("./common"),net=require("net"),argv=require("optimist").boolean("o").describe("o","Allow open connections to any remote host").argv,server=common.newServer(argv.p||3001),openconnection=argv.o||!1;openconnection,server.newEndpoint("open",function(e){var t=e.host||"localhost",n=e.port||22;openconnection||(t="localhost",n=22);var r=net.connect(n,t,function(){function t(e){r.write(new Buffer(e.d,"binary"))}var n=server.newEndpoint(null,t,function(){r.end()});r.on("data",function(t){server.sendMessage({c:e.i,s:n.id,d:t.toString("binary")})}),r.on("close",function(){server.sendMessage({c:"x",i:e.i}),n.close()}),server.sendMessage({c:e.i,i:n.id})});r.on("error",function(e){})}),setInterval(function(){server.sendMessage({c:"p"})},1e3);